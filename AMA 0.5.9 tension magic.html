<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academia Magica Apocalyptica Character Sheet</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        /* Base styles */
        body {
            font-family: "Bookman Old Style", Georgia, serif;
            max-width: 11in;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f0f0;
        }
        
        /* Layout */
        .page {
            display: grid;
            grid-template-columns: 1fr 2fr .9fr;
            gap: 20px;
            border: 5px double #000;
            padding: 20px;
            background-color: white;
            margin-bottom: 20px;
        }
        
        /* Common styles */
        .section {
            border: 1px solid #000;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .dotted-line {
            border-bottom: 1px dotted #000;
            height: 1.5em;
            margin: 5px 0;
        }
        
        .checkbox {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 1px solid #000;
            margin-right: 5px;
        }
        
        /* Header styles */
        .title {
            grid-column: 1 / -1;
            text-align: center;
            font-size: 25px;
            /* margin-bottom: 5px; */
            letter-spacing: 4px;
            padding: 10px 0;
        }
        
        .title::before, .title::after {
            content: "✧ ❈ ✧";
            font-size: 20px;
            padding: 0px 11px;
            color: #333;
        }
        
        .setting {
            grid-column: 1 / -1;
            text-align: center;
            font-style: italic;
            margin-bottom: 15px;
            padding: 10px;
            border-top: 1px solid #000;
            border-bottom: 1px solid #000;
            line-height: 1.4;
        }
        
        /* Section headers */
        .section-title {
            text-align: center;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .section-title::before, .section-title::after {
            content: "✧";
            margin: 0 10px;
        }
        
        /* Stats styling */
        .stat-row {
            text-align: center;
            margin: 15px 0;
        }
        
        .stat-name {
            display: inline-block;
            margin-right: 10px;
            font-weight: bold;
            font-size: 1.2em;
        }
        
        .die-placeholder {
            display: inline-block;
            color: #999;
            font-style: italic;
            font-size: 1.2em;
        }
        
        .specializations {
            margin-top: 8px;
            display: flex;
            justify-content: center;
            gap: 20px;
            font-size: 0.9em;
        }
        
        /* Utility classes */
        .instructions {
            font-style: italic;
            font-size: 0.9em;
            margin-bottom: 10px;
        }
        
        .success-tiers {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;

        }
        
        .token-box {
            width: 100px;
            height: 100px;
            border: 2px solid #000;
            margin: 10px auto;
        }

        /* Circle Visualization styles */
        #visualization {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            /* box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); */
            margin: 0 auto;
            width: fit-content;
            margin-bottom: 0px;
        }

        .curved-text {
            font-size: 14px;
            fill: #333;
        }

        .viz-container {
            /* grid-column: 1 / -1; */
            display: flex;

            /* margin-top: 20px; */
            /* padding: 20px; */
            border: 1px solid #000;
        }

        @page {
            size: portrait;
            margin: 0.47in;
        }
    </style>
</head>
<body>
    <div class="page">
        <div class="title">✧ ACADEMIA MAGICA APOCALYPTICA ✧</div>
        <div class="setting">"While competing at the _________ Battle Royale, something went catastrophically wrong, hurling you and your competitors X00 years into a ruined future. All around you lies an apocalyptic wasteland, where survival means trusting your former rivals. Together, you must uncover what happened that day - and find a way back home."</div>
        
        <div>
            <div class="section">
                <div class="section-title">Character</div>
                <div style="font-size: 0.9em;">Name/School/House:<div class="dotted-line"></div></div>
                <!-- <div>School/House:<div class="dotted-line"></div></div>
                <div>Look:<div class="dotted-line"></div></div> -->
                <div style="font-size: 0.9em;">Look/Spellcraft:<div class="dotted-line"></div></div>
            </div>        
            <div class="section">
                <div class="section-title">Rolling</div>
                <ul style="font-size: 0.9em; margin: 0; padding-left: 18px;">
                    <li>Roll and sum up two attribute dice - one you pick, one the GM picks.</li>
                    <li>Add +1 for each applicable style under those stats.</li>
                    <li>Success levels determined by tiers.</li>
                    <li>Anima, Tension, and taking hits can modify results.</li>
                </ul>
            </div>
            <div class="section">
                <div class="section-title">Magic</div>
                <div class="instructions"> A.M.A. is genre- and culture-agnostic regarding magic. The only principle is that magic depends on visualization/imagination. 
                    Just make sure to stick to one character concept.</div>
                <ul style="font-size: 0.9em; margin: 0; padding-left: 18px;">
                    <li>Reflexive lesser illusions may be Mysterious and Mindful. </li>
                    <li>Complex ritual spells might be Rigorous and Visionary. </li>
                    <li>Primal shapeshifting might be Adaptive + ?, based on the type of creature. </li>
                    <li>Any stats could be used for defense depending on how you evade / block.</li>
                </ul>
            </div> 
 
            <div class="section">
                <div class="section-title">Downtime</div>
                <div class="instructions" style="margin: 0">Choose 2 changes:</div>
                <ul style="font-size: 0.9em; margin: 0; padding-left: 18px;">
                    <li>Try a new style.</li>
                    <li>Swap two dice of +/-2.</li>
                    <li>Help and make a friend.</li>
                    <li>Rerank a need.</li>                    
                </ul> 
                <div class="instructions" style="margin-bottom:0">Then, gain 1 anima per friend and met need.</div>
                <div class="instructions" style="margin-bottom:0">Then, roll all dice: unfulfill those needs.</div>
                <div class="instructions" style="margin-bottom:0">Then, reset overflow.</div>
            </div>
                
            <!-- <div class="section-credits" style="font-size:10pt">
                <div class="section-title" >v. 0.5.6 Non-A ed.</div>
                <div class="instructions" style="margin-bottom:0; text-align:center">Psynapshots, January 22, 2025</div>
            </div>   -->
        </div>

        <div>
            <div class="section">
                <div class="section-title">Spellcraft Style</div>
                <div class="instructions">Assign one unique die (d4/d6/d8/d10/d12) to each attribute. Choose one preferred style per attribute. 
                    <span style="font-style:italic"> Note: these attributes describe only your spellcraft; your personality may be different. Social and psycho-emotional rolls are handled with the Needs Wheel.</span></div>
                
                <div class="stat-row">
                    <div><span class="stat-name">Mystique</span><span class="die-placeholder">d___</span></div>
                    <div class="specializations">
                        <span><div class="checkbox"></div>Graceful</span>
                        <span><div class="checkbox"></div>Mysterious</span>
                    </div>
                </div>
                <div class="stat-row">
                    <div><span class="stat-name">Acumen</span><span class="die-placeholder">d___</span></div>
                    <div class="specializations">
                        <span><div class="checkbox"></div>Astute</span>
                        <span><div class="checkbox"></div>Rigorous</span>
                    </div>
                </div>
                <div class="stat-row">
                    <div><span class="stat-name">Grit</span><span class="die-placeholder">d___</span></div>
                    <div class="specializations">
                        <span><div class="checkbox"></div>Tenacious</span>
                        <span><div class="checkbox"></div>Adaptive</span>
                    </div>
                </div>
                <div class="stat-row">
                    <div><span class="stat-name">Instinct</span><span class="die-placeholder">d___</span></div>
                    <div class="specializations">
                        <span><div class="checkbox"></div>Mindful</span>
                        <span><div class="checkbox"></div>Courageous</span>
                    </div>
                </div>
                <div class="stat-row">
                    <div><span class="stat-name">Craft</span><span class="die-placeholder">d___</span></div>
                    <div class="specializations">
                        <span><div class="checkbox"></div>Resourceful</span>
                        <span><div class="checkbox"></div>Visionary</span>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-title">Success Tiers</div>
                <div class="success-tiers" >
                    <div  style="margin-bottom:0">7+ Messy 🗴🗸</div>
                    <div style="margin-bottom:0">16+ Greater 🗸🗸🗸</div>
                    <div style="margin-bottom:0">10+ Lesser 🗸</div>
                    <div style="margin-bottom:0">19+ Extraordinary 🗸🗸🗸🗸🗸</div>
                    <div style="margin-bottom:0">13+ Solid 🗸🗸</div>
                    <div style="margin-bottom:0">22+ Aetheric 🗸🗸🗸🗸🗸🗸🗸</div>
                </div>
            </div>
            <div class="section">
                <div class="section-title">Ring of Psychosocial  Needs</div>
                <!-- Psychosocial? Universal? Ubiquitous? Character? Sympathetic? -->
                <div class="instructions" style="margin-bottom: 0;">
                    Order each Need from (1) most insecure to (9) most secure.
                    Your longest chain of unfulfilled needs determines your <u>Tension score</u>.
                    When a Need gets met, mark the checkbox. If the Need is already met, mark overflow (outside circle) and gain 1 Anima.
                    Overflow checkmarks reset at the end of Downtime. Social checks are done by rolling all the dice: matching the target's # is solid; being 1-off is messy. +1 checkmark if your fulfillment state for the relevant Needs match theirs. </div>
                    <div id="visualization"></div>
            </div>
           
        </div>

        <div>
            <div class="section">
                <div class="section-title">Anima</div>
                <div class="instructions" style="margin: 0">Tokens gained from overflow, downtime, and items. <u>Failing checks can indirectly fulfill needs by giving others opportunities to help.</u> 
                    Spend 1:1 to boost your friend's rolls; 2:1 for strained friendships and others.</div>
                <!-- <div class="token-box"><span style="opacity:.25; font-size: 0.9em; "><i>Start with 9</i></span></div> -->
            </div>
            <div class="section">
                <div class="section-title">Hits</div>
                <div class="instructions" style="margin: 0">Choose 1 per hit, or 2 then fulfill another Need:</div>
                <ul style="font-size: 0.9em; margin: 0; padding-left: 18px;">
                    <li>Unfulfill 1 Need.</li>
                    <li>Lose confidence in a style. Uncheck it.</li>
                    <li>Strain a friendship. Uncheck it.</li>
                    <!-- <li>Lower a stat die to d6 until end of downtime.</li> -->
                </ul>
            </div>
            <div class="section">
                <div class="section-title">Friends</div>
                <div class="instructions">Record their name and how you gained each others' trust. </div>
                <div><div class="checkbox"></div>1st: <span style="opacity:.3; font-size:.9rem"><i>Yourself(?)</i></span><div class="dotted-line"></div></div>
                <div><div class="checkbox"></div>2nd: <div class="dotted-line"></div></div>
                <div><div class="checkbox"></div>3rd: <div class="dotted-line"></div></div>
                <div><div class="checkbox"></div>4th: <div class="dotted-line"></div></div>
                <div><div class="checkbox"></div>5th: <div class="dotted-line"></div></div>
                <div><div class="checkbox"></div>6th: <div class="dotted-line"></div></div>

            </div>
            <div class="section">
                <div class="section-title">Tension 
                </div>
            <div class="instructions" style="margin-bottom:0">Let go and risk disaster: Until Tension ≤ 3: +Tension to every roll but you can no longer +Anima. </div>
            </div>  
            <div class="section-credits" style="font-size:10pt">
                <div class="section-title" >v. 0.5.9 Tension Magic</div>
                <div class="instructions" style="margin-bottom:0; text-align:center">Psynapshots, February 4, 2025</div>
            </div>  
        </div>          
    </div>

    <script>
        // Create SVG container
        const svg = d3.select("#visualization")
            .append("svg")
            .attr("width", 400)
            .attr("height", 354);

        // Add defs for our text paths
        const defs = svg.append("defs");

        // Calculate the radius of each circle
        const circleRadius = 55;
        const ringRadius = .53*circleRadius / Math.sin(Math.PI / 9);

        // Create center point of the ring
        const centerX = 200;
        const centerY = 177

        // Sample text for each circle with custom start angles (in degrees)

        const circleData = [
            { text: "aspiration", textStartAngle: 325 },
            { text: "appreciation", textStartAngle: 320 },
            { text: "authenticity", textStartAngle: 325 },
            { text: "affection", textStartAngle: 328  },
            { text: "acceptance", textStartAngle: 316 },
            { text: "allegiance", textStartAngle: 325 },
            { text: "autonomy", textStartAngle: 322 },
            { text: "artistry", textStartAngle: 332 },
            { text: "ascertainment", textStartAngle: 303}
        ];

        // Generate complete data for 9 circles, each 40 degrees apart
        const completeCircleData = circleData.map((data, i) => {
            const angle = (i * 40) * (Math.PI / 180); // Convert degrees to radians
            return {
                x: centerX + ringRadius * Math.cos(angle),
                y: centerY + ringRadius * Math.sin(angle),
                angle: angle,
                text: data.text,
                textStartAngle: data.textStartAngle,
                id: `circle-${i}`
            };
        });

        // Create circular paths for text
        completeCircleData.forEach(d => {
            // Create a circular path around each circle
            const textPathRadius = circleRadius + 5; // Slightly larger than circle radius
            
            // Calculate the start point of the arc using the custom textStartAngle
            const startAngle = d.angle + (d.textStartAngle * Math.PI / 180);
            const textPath = defs.append("path")
                .attr("id", d.id)
                .attr("d", `
                    M ${d.x + textPathRadius * Math.cos(startAngle)},
                      ${d.y + textPathRadius * Math.sin(startAngle)}
                    A ${textPathRadius} ${textPathRadius} 0 1 1
                      ${d.x + textPathRadius * Math.cos(startAngle - 0.01)},
                      ${d.y + textPathRadius * Math.sin(startAngle - 0.01)}
                `);
        });

        // Create groups for circles and their text
        const groups = svg.selectAll("g")
            .data(completeCircleData)
            .enter()
            .append("g");

        // Draw the circles
        groups.append("circle")
            .attr("cx", d => d.x)
            .attr("cy", d => d.y)
            .attr("r", circleRadius)
            .attr("fill", "grey")
            .attr("fill-opacity", ".07")
            .attr("stroke", "none")
            .attr("stroke-width", 1);

        // Add text that follows the circular paths
        groups.append("text")
            .attr("class", "curved-text")
            .attr("dy", -2) // Adjust text position relative to path
            .style("font-size", "16px")
            .append("textPath")
            .attr("href", d => `#${d.id}`)
            .attr("startOffset", "0%")
            .text(d => d.text);

        // Add checkboxes (overflow)
        const checkboxGroups = groups.append("g")
            .attr("class", "checkbox")
            .attr("transform", d => {
                // Calculate position for checkbox
                const textPathRadius = circleRadius + 30; // Position outside the text
                const checkboxAngle = d.angle + Math.PI / 180; // Adjust angle to position after text
                const x = d.x + textPathRadius * Math.cos(checkboxAngle);
                const y = d.y + textPathRadius * Math.sin(checkboxAngle);
                return `translate(${x},${y})`;
            })
            ;
        // Add checkboxes inside
        const checkboxGroups2 = groups.append("g")
            .attr("class", "checkbox")
            .attr("transform", d => {
                // Calculate position for checkbox
                const textPathRadius = circleRadius - 20; // Position inside the text
                const checkboxAngle = d.angle + Math.PI / 180; // Adjust angle to position after text
                const x = d.x + textPathRadius * Math.cos(checkboxAngle);
                const y = d.y + textPathRadius * Math.sin(checkboxAngle);
                return `translate(${x},${y})`;
            })
            ;

        // Add the checkbox rectangles
        const sidelength = 12

        checkboxGroups.append("circle")
            .attr("x", d => d.x)
            .attr("y", d => d.y)
            .attr("r", 8)
            // .attr("rx", 2)
            // .attr("ry", 2) 
            .attr("fill", "white")
            .attr("stroke", "black")
            .attr("opacity", ".3");

        const sidelength2 = 12
        checkboxGroups2.append("rect")
            .attr("x", -sidelength2/2)
            .attr("y", -sidelength2/2)
            .attr("width", sidelength2)
            .attr("height", sidelength2)
            // .attr("rx", 2)
            // .attr("ry", 2)
            .attr("fill", "white")
            .attr("stroke", "black");
    </script>
</body>
</html>